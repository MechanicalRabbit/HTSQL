#
# Copyright (c) 2006-2010, Prometheus Research, LLC
# Authors: Clark C. Evans <cce@clarkevans.com>,
#          Kirill Simonov <xi@resolvent.net>
#

title: PostgreSQL regression tests
id: pgsql
output: test/output/pgsql.yaml
tests:
# FIXME: need a regression schema and a set of tests.

- title: Remove any existing regression database
  id: cleanup-pgsql
  tests:
  - connect: &admin-connect
      engine: pgsql
      database: postgres
      username: ${PGSQL_ADMIN_USERNAME}
      password: ${PGSQL_ADMIN_PASSWORD}
      host: ${PGSQL_HOST}
      port: ${PGSQL_PORT}
    sql: |
        DROP DATABASE IF EXISTS "htsql_regress";
        DROP ROLE IF EXISTS "htsql_regress";
    autocommit: true

- title: Deploy the regression database
  id: setup-pgsql
  tests:
  - connect: *admin-connect
    sql: |
        CREATE DATABASE "htsql_regress" WITH ENCODING = 'UTF-8';
        CREATE ROLE "htsql_regress" WITH LOGIN PASSWORD 'secret';
        ALTER DATABASE "htsql_regress" OWNER TO "htsql_regress";
    autocommit: true
  - connect: &connect
      engine: pgsql
      database: htsql_regress
      username: htsql_regress
      password: secret
      host: ${PGSQL_HOST}
      port: ${PGSQL_PORT}
    sql-include: test/sql/regress-pgsql.sql

- db: *connect

- title: Queries
  id: queries-pgsql
  tests:
  - uri: /
  - uri: /{2+2}
    skip: true
  - uri: /test
  - uri: /test{id}
  - uri: /test{data}?id=1
    skip: true

