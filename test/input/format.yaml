#
# Copyright (c) 2006-2012, Prometheus Research, LLC
# See `LICENSE` for license information, `AUTHORS` for the list of authors.
#

title: Formatting Output Data
id: format
tests:

- title: Supported Output Formats
  tests:
  - uri: /school/:json
  - uri: /school/:obj
  - uri: /school/:csv
  - uri: /school/:tsv
  - uri: /school/:xml
  - uri: /school/:html
  - uri: /school/:txt
  - uri: /school/:unknown
    expect: 400

- title: Format Selection by `Accept`
  tests:
  - uri: /school
    headers:
      Accept: application/json
  - uri: /school
    headers:
      Accept: text/csv
  - uri: /school
    headers:
      Accept: text/tab-separated-values
  - uri: /school
    headers:
      Accept: application/xml
  - uri: /school
    headers:
      Accept: text/html
  - uri: /school
    headers:
      Accept: text/plain
  # Empty segment
  - uri: /
    headers:
      Accept: application/json
  - uri: /
    headers:
      Accept: text/csv
  - uri: /
    headers:
      Accept: application/xml
  - uri: /
    headers:
      Accept: text/html
  - uri: /
    headers:
      Accept: text/plain

- title: The `AS` Decorator
  tests:
    - uri: /(school :as 'List of Schools')
            {name :as Name, count(department) :as '# of Departments'}
            /:json
    - uri: /(school :as 'List of Schools')
            {name :as Name, count(department) :as '# of Departments'}
            /:obj
    - uri: /(school :as 'List of Schools')
            {name :as Name, count(department) :as '# of Departments'}
            /:csv
    - uri: /(school :as 'List of Schools')
            {name :as Name, count(department) :as '# of Departments'}
            /:tsv
    - uri: /(school :as 'List of Schools')
            {name :as Name, count(department) :as '# of Departments'}
            /:xml
    - uri: /(school :as 'List of Schools')
            {name :as Name, count(department) :as '# of Departments'}
            /:html
    - uri: /(school :as 'List of Schools')
            {name :as Name, count(department) :as '# of Departments'}
            /:txt

- title: Data Types
  tests:
  - uri: /{null(), true(), false(), 60, 2.125, 271828e-5, 'HTSQL',
           date('2010-04-15'), time('20:13:04.5'), datetime('2010-04-15 20:13')}
          /:json
  - uri: /{null(), true(), false(), 60, 2.125, 271828e-5, 'HTSQL',
           date('2010-04-15'), time('20:13:04.5'), datetime('2010-04-15 20:13')}
          /:obj
  - uri: /{null(), true(), false(), 60, 2.125, 271828e-5, 'HTSQL',
           date('2010-04-15'), time('20:13:04.5'), datetime('2010-04-15 20:13')}
          /:csv
  - uri: /{null(), true(), false(), 60, 2.125, 271828e-5, 'HTSQL',
           date('2010-04-15'), time('20:13:04.5'), datetime('2010-04-15 20:13')}
          /:tsv
  - uri: /{null(), true(), false(), 60, 2.125, 271828e-5, 'HTSQL',
           date('2010-04-15'), time('20:13:04.5'), datetime('2010-04-15 20:13')}
          /:xml
  - uri: /{null(), true(), false(), 60, 2.125, 271828e-5, 'HTSQL',
           date('2010-04-15'), time('20:13:04.5'), datetime('2010-04-15 20:13')}
          /:html
  - uri: /{null(), true(), false(), 60, 2.125, 271828e-5, 'HTSQL',
           date('2010-04-15'), time('20:13:04.5'), datetime('2010-04-15 20:13')}
          /:txt

- title: No Rows
  tests:
  - uri: /school?false()/:json
  - uri: /school?false()/:obj
  - uri: /school?false()/:csv
  - uri: /school?false()/:tsv
  - uri: /school?false()/:xml
  - uri: /school?false()/:html
  - uri: /school?false()/:txt

- title: Empty Selector
  tests:
  - uri: /{}/:json
  - uri: /{}/:obj
  - uri: /{}/:csv
  - uri: /{}/:tsv
  - uri: /{}/:xml
  - uri: /{}/:html
  - uri: /{}/:txt
  - uri: /school{}?campus='old'/:json
  - uri: /school{}?campus='old'/:obj
  - uri: /school{}?campus='old'/:csv
  - uri: /school{}?campus='old'/:tsv
  - uri: /school{}?campus='old'/:xml
  - uri: /school{}?campus='old'/:html
  - uri: /school{}?campus='old'/:txt
  - uri: /department{name, school{}}?!school|school.campus='north'/:json
  - uri: /department{name, school{}}?!school|school.campus='north'/:obj
  - uri: /department{name, school{}}?!school|school.campus='north'/:csv
  - uri: /department{name, school{}}?!school|school.campus='north'/:tsv
  - uri: /department{name, school{}}?!school|school.campus='north'/:xml
  - uri: /department{name, school{}}?!school|school.campus='north'/:html
  - uri: /department{name, school{}}?!school|school.campus='north'/:txt

- title: Special Characters
  tests:
  - uri: /{'%01%02%03%04%05%06%07%08%09%0A%0B%0C%0D%0E%0F%10',
           '%11%12%13%14%15%16%17%18%19%1A%1B%1C%1D%1E%1F%7F',
           '%CE%BE', '\/%25''"&<>#', ''}/:json
  - uri: /{'%01%02%03%04%05%06%07%08%09%0A%0B%0C%0D%0E%0F%10',
           '%11%12%13%14%15%16%17%18%19%1A%1B%1C%1D%1E%1F%7F',
           '%CE%BE', '\/%25''"&<>#', ''}/:obj
  - uri: /{'%01%02%03%04%05%06%07%08%09%0A%0B%0C%0D%0E%0F%10',
           '%11%12%13%14%15%16%17%18%19%1A%1B%1C%1D%1E%1F%7F',
           '%CE%BE', '\/%25''"&<>#', ''}/:csv
  - uri: /{'%01%02%03%04%05%06%07%08%09%0A%0B%0C%0D%0E%0F%10',
           '%11%12%13%14%15%16%17%18%19%1A%1B%1C%1D%1E%1F%7F',
           '%CE%BE', '\/%25''"&<>#', ''}/:tsv
  - uri: /{'%01%02%03%04%05%06%07%08%09%0A%0B%0C%0D%0E%0F%10',
           '%11%12%13%14%15%16%17%18%19%1A%1B%1C%1D%1E%1F%7F',
           '%CE%BE', '\/%25''"&<>#', ''}/:xml
  - uri: /{'%01%02%03%04%05%06%07%08%09%0A%0B%0C%0D%0E%0F%10',
           '%11%12%13%14%15%16%17%18%19%1A%1B%1C%1D%1E%1F%7F',
           '%CE%BE', '\/%25''"&<>#', ''}/:html
  - uri: /{'%01%02%03%04%05%06%07%08%09%0A%0B%0C%0D%0E%0F%10',
           '%11%12%13%14%15%16%17%18%19%1A%1B%1C%1D%1E%1F%7F',
           '%CE%BE', '\/%25''"&<>#', ''}/:txt

- title: Commands
  tests:
  - uri: /school/:retrieve
  - uri: /retrieve(/school)
  - uri: /school/:retrieve/:json
  - uri: /school/:sql
  - uri: /school/:retrieve/:sql
  # Errors
  - uri: /retrieve()
    expect: 400
  - uri: /retrieve(school)
    expect: 400
  - uri: /school/:html/:retrieve
    expect: 400
  - uri: /school/:html/:json
    expect: 400
  - uri: /school/:html/:sql
    expect: 400

