#
# Copyright (c) 2006-2012, Prometheus Research, LLC
#

title: ETL/CRUD
id: etl
ifdef: pgsql
tests:
- load: etl
- uri: /truncate(product_line)
- uri: /truncate(manufacturer)
- uri: /manufacturer:={code:='ACID', name:='Acer'}
        /:insert
- uri: /manufacturer:={code:='DELL', name:='Dell'}
        /:insert
- uri: /manufacturer:={code:='TOSH', name:='Toshiba'}
        /:insert
- uri: /manufacturer:={code:='0992', name:='Lenovo'}
        /:insert
- uri: /manufacturer:={code:='2376', name:='Gigabyte'}
        /:insert
- uri: /manufacturer:={code:='AAPL', name:='Apple'}
        /:insert
  headers:
    Accept: application/json
- uri: /manufacturer:={code:='6702', name:='Fujitsu'}
        /:insert
  headers:
    Accept: x-htsql/raw
- uri: /manufacturer:={code:='ACID', name:='Acer'}
        /:insert
  expect: 409
- uri: /manufacturer:={'SMSN', 'Samsung'}
        /:insert
  expect: 409
- uri: /manufacturer:={code:='SMSN'}
        /:insert
  expect: 409
- uri: /manufacturer:={name:='Samsung'}
        /:insert
  expect: 409
- uri: /manufacturer:={code:='SMSN', name:='Samsung',
                       full_name:='Samsung Electronics Co Ltd'}
        /:insert
  expect: 400
- uri: /manufacturer:={code:='SMSN', name:=true}
        /:insert
  expect: 400
- uri: /manufacturer:={code:='SMSN', name:='Samsung'}
        /:insert
- uri: /manufacturer{id(), *}
- uri: /product_line:={manufacturer_code:='SMSN',
                       code:='GT', title:='Galaxy Note'}
        /:insert
- uri: /product_line:={manufacturer_code:=@manufacturer[2376].code,
                       code:='U', title:='Extreme Ultrabook'}
        /:insert
- uri: /product_line:={manufacturer:='SMSN',
                       code:='5', title:='Series 5 Ultrabook'}
        /:insert
  skip: true
- uri: /product_line:={manufacturer:=top(@manufacturer?name~'fujitsu').id(),
                       code:='E', title:='Lifebook E Series'}
        /:insert
  skip: true


