#
# Copyright (c) 2006-2012, Prometheus Research, LLC
#

title: ETL/CRUD
id: etl
ifdef: pgsql
tests:
- load: etl
- uri: /truncate(product_line)
- uri: /truncate(manufacturer)
- uri: /manufacturer:={code:='ACID', name:='Acer'}
        /:insert
- uri: /manufacturer:={code:='DELL', name:='Dell'}
        /:insert
- uri: /{'TOSH' :as code, 'Toshiba' :as name} :as manufacturer
        /:insert
- uri: /{code:='0992', name:='Lenovo'} :as manufacturer
        /:insert
- uri: /manufacturer:={'2376' :as code, 'Gigabyte' :as name}
        /:insert
- uri: /manufacturer:={code:='AAPL', name:='Apple'}
        /:insert
  headers:
    Accept: application/json
- uri: /manufacturer:={code:='6702', name:='Fujitsu'}
        /:insert
  headers:
    Accept: x-htsql/raw
- uri: /manufacturer:={code:='ACID', name:='Acer'}
        /:insert
  expect: 409
- uri: /manufacturer:={'SMSN', 'Samsung'}
        /:insert
  expect: 409
- uri: /manufacturer:={code:='SMSN'}
        /:insert
  expect: 409
- uri: /manufacturer:={name:='Samsung'}
        /:insert
  expect: 409
- uri: /manufacturer:={code:='SMSN', name:='Samsung',
                       full_name:='Samsung Electronics Co Ltd'}
        /:insert
  expect: 400
- uri: /manufacturer:={code:='SMSN', name:=true}
        /:insert
  expect: 400
- uri: /manufacturer:={code:='SMSN', name:='Samsung'}
        /:insert
- uri: /manufacturer{id(), *}
- uri: /product_line:={manufacturer_code:='SMSN',
                       code:='GT', title:='Galaxy Note'}
        /:insert
- uri: /product_line:={manufacturer_code:=@manufacturer[2376].code,
                       code:='U', title:='Extreme Ultrabook'}
        /:insert
- uri: /product_line:={manufacturer:='SMSN',
                       code:='5', title:='Series 5 Ultrabook'}
        /:insert
- uri: /product_line:={manufacturer:=top(@manufacturer?name~'fujitsu').id(),
                       code:='E', title:='Lifebook E Series'}
        /:insert
- uri: /product_line:={manufacturer:='0992',
                       code:='Z', title:='IdeaPad Z Series'}
        /:insert
- uri: /product_line
- uri: /product:={sku:='A0000001',
                  product_line:='6702.E',
                  title:='Fujitsu LifeBook AH552/SL Notebook',
                  description:='Are you looking for an essential notebook with an extra-slim design, suitable for daily use? Then the 39.6 cm (15.6-inch) Fujitsu LIFEBOOK AH552/SL is the right choice. With only 25.4 mm in height and weight of 2.2 kg it fits into nearly every bag. Thanks to integrated WLAN and Bluetooth® you can work anytime and anywhere and the elegant aluminum cover gives you the headturning looks.',
                  list_price:=null}
        /:insert
- uri: /product:={sku:='A0000002',
                  product_line:=[0992.Z],
                  title:='Lenovo IdeaPad Z580'}
        /:merge
- uri: /product:={sku:='A0000002',
                  description:='IdeaPad Z Series laptops offer you a great balance of multimedia performance, affordability, and bold style, so you’re sure to make impressions as well as be entertained - no matter where you go',
                  list_price:='699.00'}
        /:merge
- uri: /product:={list_price:='649.00'}
        /:merge
  expect: 400
- uri: /product:={[A0000002],
                  list_price:='649.00'}
        /:update
- uri: /product:={sku:='A0000003',
                  manufacturer:='SMSN',
                  title:='Smart TV'}
        /:insert
- uri: /product[A0000003]
        /:delete
  expect: 400
- uri: /product[A0000003]{id()}
        /:delete
- uri: /do(/product:={sku:='A0000003',
                      manufacturer:=[0992],
                      title:='Lenovo ThinkPad T430'}/:insert,
           /product[A0000003])
- uri: /product

